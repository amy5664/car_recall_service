-- 리콜 기본 정보 테이블 RECALL --
CREATE TABLE RECALL (
    ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    MAKER VARCHAR(100),
    MODEL_NAME VARCHAR(100),
    MAKE_START VARCHAR(20),
    MAKE_END VARCHAR(20),
    RECALL_DATE VARCHAR(20),
    RECALL_REASON TEXT
);

-- 차량 정보 테이블 VEHICLE --
CREATE TABLE VEHICLE (
    VIN VARCHAR(50) PRIMARY KEY, -- 차량 식별 번호 (Vehicle Identification Number)
    MAKER VARCHAR(100) NOT NULL, -- 제조사
    MODEL_NAME VARCHAR(100) NOT NULL, -- 모델 이름
    MANUFACTURE_DATE DATE -- 실제 생산 날짜
);

-- 리콜 대상 매핑 테이블 RECALL_TARGET --
CREATE TABLE RECALL_TARGET (
    RECALL_ID BIGINT NOT NULL, -- RECALL 테이블의 ID (외래 키)
    VEHICLE_VIN VARCHAR(50) NOT NULL, -- VEHICLE 테이블의 VIN (외래 키)
    IS_REPAIRED CHAR(1) DEFAULT 'N' NOT NULL, -- 수리 완료 여부 ('Y' 또는 'N')

    -- 두 칼럼을 합쳐 복합 기본 키 (Composite Primary Key)로 지정
    PRIMARY KEY (RECALL_ID, VEHICLE_VIN),

    -- 외래 키 설정: RECALL 테이블 참조
    CONSTRAINT FK_TARGET_RECALL
        FOREIGN KEY (RECALL_ID)
        REFERENCES RECALL (ID),

    -- 외래 키 설정: VEHICLE 테이블 참조
    CONSTRAINT FK_TARGET_VEHICLE
        FOREIGN KEY (VEHICLE_VIN)
        REFERENCES VEHICLE (VIN)
);

-- 회원 테이블 MEMBER --
CREATE TABLE member (
    username VARCHAR(255) NOT NULL PRIMARY KEY,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    email_verified CHAR(1) DEFAULT 'N' NOT NULL
);

-- 사용자 관심 차량 테이블 USER_VEHICLE --
CREATE TABLE USER_VEHICLE (
    ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    USERNAME VARCHAR(255) NOT NULL,
    MAKER VARCHAR(100) NOT NULL,
    MODEL_NAME VARCHAR(100) NOT NULL,
    CONSTRAINT FK_USER_VEHICLE_MEMBER FOREIGN KEY (USERNAME) REFERENCES MEMBER (USERNAME)
);

-- 알림 테이블 NOTIFICATION --
CREATE TABLE NOTIFICATION (
    ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    USERNAME VARCHAR(255) NOT NULL,
    TYPE VARCHAR(50) NOT NULL, -- RECALL, DEFECT_REPORT
    TITLE VARCHAR(255) NOT NULL,
    MESSAGE TEXT NOT NULL,
    LINK VARCHAR(500),
    IS_READ CHAR(1) DEFAULT 'N' NOT NULL,
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_NOTIFICATION_MEMBER FOREIGN KEY (USERNAME) REFERENCES MEMBER (USERNAME)
);

-- 결함 신고 테이블 DEFECT_REPORT --
CREATE TABLE DEFECT_REPORT (
    ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    USERNAME VARCHAR(255),
    REPORTER_NAME VARCHAR(255),
    CONTACT VARCHAR(255),
    CAR_MODEL VARCHAR(255),
    VIN VARCHAR(50),
    DEFECT_DETAILS TEXT,
    REPORT_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
    PASSWORD VARCHAR(255),
    STATUS VARCHAR(50) DEFAULT '접수',
    CONSTRAINT FK_DEFECT_REPORT_MEMBER FOREIGN KEY (USERNAME) REFERENCES MEMBER (USERNAME)
);

-- 결함 이미지 테이블 DEFECT_IMAGE --
CREATE TABLE DEFECT_IMAGE (
    ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    REPORT_ID BIGINT NOT NULL,
    FILE_NAME VARCHAR(255) NOT NULL,
    UPLOAD_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_DEFECT_IMAGE_REPORT FOREIGN KEY (REPORT_ID) REFERENCES DEFECT_REPORT (ID) ON DELETE CASCADE
);

-- 공지사항 테이블 RECALL_NOTICE_DB --
CREATE TABLE RECALL_NOTICE_DB (
    notice_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    content TEXT,
    views INT DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_urgent CHAR(1) DEFAULT 'N',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 게시판 테이블 RECALL_BOARD (page.xml, upload.xml 참조) --
CREATE TABLE RECALL_BOARD (
    BOARD_NO BIGINT PRIMARY KEY AUTO_INCREMENT,
    BOARD_NAME VARCHAR(255),
    BOARD_TITLE VARCHAR(255),
    BOARD_CONTENT TEXT,
    BOARD_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
    HIT INT DEFAULT 0
);

-- 온라인 민원 테이블 ONLINE_COMPLAIN (complain.xml 참조) --
CREATE TABLE ONLINE_COMPLAIN (
    REPORT_ID BIGINT PRIMARY KEY AUTO_INCREMENT,
    REPORTER_NAME VARCHAR(255),
    PASSWORD VARCHAR(255),
    PHONE VARCHAR(255),
    TITLE VARCHAR(255),
    COMPLAIN_TYPE VARCHAR(50),
    CARNUM VARCHAR(50),
    IS_PUBLIC CHAR(1),
    COMPLAINDATE DATETIME DEFAULT CURRENT_TIMESTAMP,
    CONTENT TEXT,
    ANSWER TEXT
);

-- 관리자 계정 테이블 ADMIN_ACCOUNT (admin.xml 참조) --
CREATE TABLE ADMIN_ACCOUNT (
    admin_id VARCHAR(255) PRIMARY KEY,
    admin_pw VARCHAR(255) NOT NULL
);

-- FAQ 테이블 tbl_faq (faq.xml 참조) --
CREATE TABLE tbl_faq (
    faqNo BIGINT PRIMARY KEY AUTO_INCREMENT,
    faqCategory VARCHAR(100),
    faqTitle VARCHAR(255),
    faqContent TEXT,
    faqDate DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 첨부파일 테이블 BOARD_ATTACH (upload.xml 참조) --
CREATE TABLE BOARD_ATTACH (
    UUID VARCHAR(255) PRIMARY KEY,
    UPLOADPATH VARCHAR(255) NOT NULL,
    FILENAME VARCHAR(255) NOT NULL,
    IMAGE BOOLEAN NOT NULL,
    BOARDNO BIGINT NOT NULL,
    CONSTRAINT FK_BOARD_ATTACH_BOARD FOREIGN KEY (BOARDNO) REFERENCES RECALL_BOARD (BOARD_NO) ON DELETE CASCADE
);